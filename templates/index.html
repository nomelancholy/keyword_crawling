<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ í‚¤ì›Œë“œ ëª¨ë‹ˆí„°ë§</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #3498db; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #2980b9; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        .alert-section { margin-top: 40px; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeeba; border-radius: 5px; }
        .badge { display: inline-block; padding: 3px 7px; border-radius: 10px; font-size: 12px; color: #fff; }
        .badge-success { background-color: #28a745; }
        .badge-secondary { background-color: #6c757d; }
        .delete-btn { background-color: #dc3545; font-size: 12px; padding: 5px 10px; }
        .delete-btn:hover { background-color: #c82333; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ•¸ï¸ ì›¹ì‚¬ì´íŠ¸ í‚¤ì›Œë“œ ëª¨ë‹ˆí„°ë§</h1>
    
    <div style="background: #e9ecef; padding: 20px; border-radius: 5px;">
        <h2>ìƒˆ ëª¨ë‹ˆí„°ë§ ì‘ì—… ì¶”ê°€</h2>
        <form action="/tasks/add" method="post">
            <div class="form-group">
                <label for="url">íƒ€ê²Ÿ ì›¹ì‚¬ì´íŠ¸ URL (ex: https://search.naver.com/...)</label>
                <input type="text" id="url" name="url" placeholder="https://..." required>
            </div>
            <div class="form-group">
                <label for="keyword">íƒ€ê²Ÿ í‚¤ì›Œë“œ (ex: ì„œìš¸ê·€ê°ì´ë¹„ì¸í›„ê³¼)</label>
                <input type="text" id="keyword" name="keyword" placeholder="ì°¾ì„ ë‹¨ì–´" required>
            </div>
            <div class="form-group">
                <label for="interval_minutes">ëª¨ë‹ˆí„°ë§ ì£¼ê¸° (ë¶„, ê¸°ë³¸ 30)</label>
                <input type="number" id="interval_minutes" name="interval_minutes" value="30" min="1" required>
            </div>
            <button type="submit">ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
        </form>
    </div>

    <h2>ğŸ“‹ ë“±ë¡ëœ ì‘ì—… ëª©ë¡</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>URL</th>
                <th>í‚¤ì›Œë“œ</th>
                <th>ì£¼ê¸°(ë¶„)</th>
                <th>ë§ˆì§€ë§‰ í™•ì¸</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    <a href="{{ task.url }}" target="_blank">{{ task.url }}</a>
                </td>
                <td><strong>{{ task.keyword }}</strong></td>
                <td>{{ task.interval_minutes }}ë¶„</td>
                <td>{{ format_kst(task.last_checked) }}</td>
                <td>
                    <form action="/tasks/{{ task.id }}/delete" method="post" style="display:inline;">
                        <button type="submit" class="delete-btn">ì‚­ì œ</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="alert-section">
        <h2>ğŸ”” ìµœê·¼ ë°œê²¬ ì•Œë¦¼</h2>
        {% if alerts %}
        <ul>
            {% for alert in alerts %}
            <li>
                <strong>{{ format_kst(alert.found_at) }}</strong> - 
                ì‘ì—… #{{ alert.task_id }} ({{ alert.task.keyword }}) ì—ì„œ í‚¤ì›Œë“œ ë°œê²¬
                <a href="{{ alert.task.url }}" target="_blank" style="margin-left: 10px; font-weight: bold; color: #007bff;">[ë°”ë¡œê°€ê¸°]</a>
                <br>
                <code>{{ alert.context }}</code>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>ì•„ì§ ë°œê²¬ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>
</div>

</body>
</html>
